# Requires tmux>=2.4
# https://github.com/rottencandy/dotfiles

################################
# Options
###############################{{{

# Changing prefix
unbind C-b
set -g prefix C-q
bind C-q send-prefix

# Switch to last window
bind a last-window

# Automatically set window titles
set-window-option -g automatic-rename on
set -g set-titles on

# Set escape time delay to be smaller
# to make tmux more responsive to commands
set -s escape-time 1
# Address vim mode-switching delay
#set -s escape-time 0

# scrollback size
set -g history-limit 5000

# pass through xterm keys
set -g xterm-keys on

# Force UTF
setw -gq utf on

set -g set-clipboard external

# Set first window to index 1 (not 0) to map more to the keyboard layout
set -g base-index 1
set -g pane-base-index 1

# tmux messages are displayed for 4 seconds
set -g display-time 4000

# Support for 256 colors in terminal
set -g default-terminal "screen-256color"

# Super useful when using "grouped sessions" and multi-monitor setup
setw -g aggressive-resize on

# Enable mouse support
set -g mouse on
bind -T root MouseUp2Pane paste


################################}}}
# Keybinds
###############################{{{

# Detach current session
bind-key C-d detach-client

# Redraw the client (if interrupted by wall, etc)
bind R refresh-client

# reload tmux config
unbind r
bind r source-file ~/.tmux.conf \; display 'Reloaded tmux config.'

# rename window
bind-key -T prefix o command-prompt -I "#W" "rename-window -- '%%'"

# new window
unbind t
unbind C-t
bind-key t new-window
bind-key C-t new-window

# New session
unbind n
unbind C-n
bind-key n new-session
bind-key C-n new-session

# Switch between next/prev window
#bind -n C-p previous-window
#bind -n C-n next-window

# Zoom in/out
unbind C-+
bind C-+ \
    new-window -d -n tmux-zoom 'clear && echo TMUX ZOOM && read'\;\
    swap-pane -s tmux-zoom.0 \;\
    select-window -t tmux-zoom
unbind C--
bind C-- \
    last-window \;\
    swap-pane -s tmux-zoom.0 \;\
    kill-window -t tmux-zoom

# Visual Activity Monitoring between windows
setw -g monitor-activity on
set -g visual-activity on

# Search and select pane using FZF
bind 0 run "tmux split-window -p 40 'bash -ci ftpane'"

################################}}}
# Pane navigation/management
###############################{{{

# Split panes
bind \ split-window -h -c '#{pane_current_path}'
bind - split-window -v -c '#{pane_current_path}'
unbind '"'
unbind %

# new panes in current path
bind c new-window -c '#{pane_current_path}'

# switch panes
bind -n M-h select-pane -L
bind -n M-l select-pane -R
bind -n M-k select-pane -U
bind -n M-j select-pane -D

# resize panes
bind -r j resize-pane -D 2
bind -r k resize-pane -U 2
bind -r h resize-pane -L 2
bind -r l resize-pane -R 2

# Copy/paste
setw -g mode-keys vi
bind -T copy-mode-vi v      send -X begin-selection
bind -T copy-mode-vi C-v    send -X rectangle-toggle
bind -T copy-mode-vi V      send -X select-line
bind -T copy-mode-vi y      send -X copy-selection-and-cancel
bind -T copy-mode-vi Escape send -X cancel
bind -T copy-mode-vi H      send -X start-of-line
bind -T copy-mode-vi L      send -X end-of-line
#bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "xsel -i -p && xsel -o -p | xsel -i -b"
#bind-key -T copy-mode-vi 'y' send -X copy-pipe-and-cancel "xsel -i --clipboard"
#bind-key p run "xsel -o | tmux load-buffer - ; tmux paste-buffer"

################################}}}
# Status line
###############################{{{

set -g status-position bottom

set -g visual-bell off
set -g visual-silence off
set -g bell-action none
set -g visual-activity off
set -g monitor-activity on

set -g status-interval 30

# Start window and pane indices at 1
set -g base-index 1
set -g pane-base-index 1

# Length of status line
set -g status-left-length 30
set -g status-right-length 150

set -g status-left '#{?client_prefix,#[bg=colour2]#[fg=colour0],}#{?window_zoomed_flag,#[bg=colour0],} #S #[fg=colour1] ♥ '
set -g status-right '#[fg=colour8]#[bg=colour8]#[fg=colour4]%a %B %d #[fg=colour1]#[fg=colour4]#[bg=colour4]#[fg=colour0]%l:%M %p #[bg=colour4]#[fg=colour12]#[bg=colour12]#[fg=colour0]#h '
#set -g status-right "#[bg=colour239]#[fg=white] %a %B %-d, %Y #[fg=colour14].:. #[fg=white]%H:%M #[fg=black,bg=colour14] #h "

setw -g window-status-separator ""

# window display in status line
set -g window-status-format "#[fg=colour11]#[bg=colour0] #I #[fg=colour15] #W "
set -g window-status-current-format "#[fg=colour1]#[bg=colour6] #I  #W #[fg=colour6]#[bg=colour0]"

set -g status-justify left

################################}}}
# Colors
###############################{{{

# Background of status line
set -g status-bg colour236
set -g status-fg colour14

# Pane borders
set -g pane-border-style fg=colour238
set -g pane-active-border-style fg=colour14

setw -g window-status-bell-style fg=colour255,bg=colour1,bold

# window list
setw -g window-status-style fg=colour3,bg=default,dim

#  modes
setw -g clock-mode-colour colour14
setw -g mode-style fg=colour3,bg=colour15,bold

# messages
set -g message-style fg=colour232,bg=colour16,bold

# reloaded message
set -g message-style fg=white,bg=default,bright

# bash script to get possible colors
#for i in {0..255} ; do
#    printf "\x1b[38;5;${i}mcolours${i}\n"
#done

#H (hostname)
#I (window index)
#S (session index)
#T (pane title)
#W (current command)
